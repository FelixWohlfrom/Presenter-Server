# The buildscript for travis ci verification
language: c++

sudo: required

services:
  - docker

env:
  global:
    - DEBIAN_FRONTEND=noninteractive
  matrix:
    - DOCKER_IMG=ubuntu:16.04
    - DOCKER_IMG=ubuntu:18.04
    - DOCKER_IMG=ubuntu:19.04

before_install:
  # Run simple code style check as early as possible to fail as early as possible
  - ./check-code-style.sh

  # Now initialize the docker image
  - docker pull $DOCKER_IMG
  - docker run -w /root --name test -d $DOCKER_IMG sleep infinity
  - docker cp . test:/root/

install:
  - docker exec test apt-get update
  - docker exec test apt-get install -y cmake qt5-default qttools5-dev-tools qtconnectivity5-dev g++ xvfb

script:
  - docker exec -t test bash -ic "mkdir build"
  - docker exec -t test bash -ic "cd build && cmake ../src && make -j"
  - docker exec -t test bash -ic "cd build && xvfb-run make test"
